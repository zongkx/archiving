<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>消息详情</title>
		<link rel="stylesheet" type="text/css" href="/static/admin/css/style.css"/>
		<script src="/static/admin/ueditor/third-party/jquery-1.10.2.min.js"></script>
		<script>
			$(function () {
				init();
			})
			function init() {
				var url = window.location.href;
				var xlh = decodeURI(url.split("=")[1]);
				$.ajax({
					url:"/article/"+xlh,
					method:'get',
					data:"",
					dataType:'json',
					contentType:'application/json',
					success:function (data) {
						var res = eval(data);
						console.log(eval(data))
						if(res.code=='1'){
							var article = res.data;
							$("#title").text(article.title);
							$("#author").text(article.author);
							$("#content").append(article.content);
						}else{
							alert(res.errorMessage);
						}
					}
				})


			}
		</script>
	</head>
	<body style="background-color: #FFFFFF;">
		<div class="article">
			<div class="article-title" id="title"></div>
			<div class="sm"><a href="#" id="author"></a><span id="create_date"></span></div>
			<div class="dl" id="content">

			</div>

		</div>
		<div class="pl">
			<div id="qq">
				<p>有什么新鲜事想告诉大家?</p>
				<div class="message" contentEditable='true'></div>
				<div class="But">
					<img src="/static/admin/images/bba_thumb.gif" class='bq' />
					<span class='submit'>发表</span>
					<!--face begin-->
					<div class="face">
						<ul>
							<li><img src="/static/admin/images/smilea_thumb.gif" title="呵呵]"></li>
							<li><img src="/static/admin/images/tootha_thumb.gif" title="嘻嘻]"></li>
							<li><img src="/static/admin/images/laugh.gif" title="[哈哈]"></li>
							<li><img src="/static/admin/images/tza_thumb.gif" title="[可爱]"></li>
							<li><img src="/static/admin/images/kl_thumb.gif" title="[可怜]"></li>
							<li><img src="/static/admin/images/kbsa_thumb.gif" title="[挖鼻屎]"></li>
							<li><img src="/static/admin/images/cj_thumb.gif" title="[吃惊]"></li>
							<li><img src="/static/admin/images/shamea_thumb.gif" title="[害羞]"></li>
							<li><img src="/static/admin/images/zy_thumb.gif" title="[挤眼]"></li>
							<li><img src="/static/admin/images/bz_thumb.gif" title="[闭嘴]"></li>
							<li><img src="/static/admin/images/bs2_thumb.gif" title="[鄙视]"></li>
							<li><img src="/static/admin/images/lovea_thumb.gif" title="[爱你]"></li>
							<li><img src="/static/admin/images/sada_thumb.gif" title="[泪]"></li>
							<li><img src="/static/admin/images/heia_thumb.gif" title="[偷笑]"></li>
							<li><img src="/static/admin/images/qq_thumb.gif" title="[亲亲]"></li>
							<li><img src="/static/admin/images/sb_thumb.gif" title="[生病]"></li>
							<li><img src="/static/admin/images/mb_thumb.gif" title="[太开心]"></li>
							<li><img src="/static/admin/images/ldln_thumb.gif" title="[懒得理你]"></li>
							<li><img src="/static/admin/images/yhh_thumb.gif" title="[右哼哼]"></li>
							<li><img src="/static/admin/images/zhh_thumb.gif" title="[左哼哼]"></li>
							<li><img src="/static/admin/images/x_thumb.gif" title="[嘘]"></li>
							<li><img src="/static/admin/images/cry.gif" title="[衰]"></li>
							<li><img src="/static/admin/images/wq_thumb.gif" title="[委屈]"></li>
							<li><img src="/static/admin/images/t_thumb.gif" title="[吐]"></li>
							<li><img src="/static/admin/images/k_thumb.gif" title="[打哈气]"></li>
							<li><img src="/static/admin/images/bba_thumb.gif" title="[抱抱]"></li>
							<li><img src="/static/admin/images/angrya_thumb.gif" title="[怒]"></li>
							<li><img src="/static/admin/images/yw_thumb.gif" title="[疑问]"></li>
							<li><img src="/static/admin/images/cza_thumb.gif" title="[馋嘴]"></li>
							<li><img src="/static/admin/images/88_thumb.gif" title="[拜拜]"></li>
							<li><img src="/static/admin/images/sk_thumb.gif" title="[思考]"></li>
							<li><img src="/static/admin/images/sweata_thumb.gif" title="[汗]"></li>
							<li><img src="/static/admin/images/sleepya_thumb.gif" title="[困]"></li>
							<li><img src="/static/admin/images/sleepa_thumb.gif" title="[睡觉]"></li>
							<li><img src="/static/admin/images/money_thumb.gif" title="[钱]"></li>
							<li><img src="/static/admin/images/sw_thumb.gif" title="[失望]"></li>
							<li><img src="/static/admin/images/cool_thumb.gif" title="[酷]"></li>
							<li><img src="/static/admin/images/hsa_thumb.gif" title="[花心]"></li>
							<li><img src="/static/admin/images/hatea_thumb.gif" title="[哼]"></li>
							<li><img src="/static/admin/images/gza_thumb.gif" title="[鼓掌]"></li>
							<li><img src="/static/admin/images/dizzya_thumb.gif" title="[晕]"></li>
							<li><img src="/static/admin/images/bs_thumb.gif" title="[悲伤]"></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="msgCon"></div>
			</div>
		
		<script type="text/javascript">
			//从缓存中获取数据并渲染
			let msgBoxList = JSON.parse(window.localStorage.getItem('msgBoxList')) || [];
			innerHTMl(msgBoxList)
		
			//点击小图片，显示表情
			$(".bq").click(function (e) {
				$(".face").slideDown(); //慢慢向下展开
				e.stopPropagation(); //阻止冒泡事件
			});
		
			//在桌面任意地方点击，关闭表情框
			$(document).click(function () {
				$(".face").slideUp(); //慢慢向上收
			});
		
			//点击小图标时，添加功能
			$(".face ul li").click(function () {
				let simg = $(this).find("img").clone();
				$(".message").append(simg); //将表情添加到输入框
			});
		
			//点击发表按扭，发表内容
			$("span.submit").click(function () {
				let txt = $(".message").html(); //获取输入框内容
				if (!txt) {
					$('.message').focus(); //自动获取焦点
					return;
				}
				let obj = {
					msg: txt
				}
				msgBoxList.unshift(obj) //添加到数组里
				window.localStorage.setItem('msgBoxList', JSON.stringify(msgBoxList)) //将数据保存到缓存
				innerHTMl([obj]) //渲染当前输入框内容
				$('.message').html('') // 清空输入框
		
			});
		
			//删除当前数据
			$("body").on('click', '.del', function () {
				let index = $(this).parent().parent().index();
				msgBoxList.splice(index, 1)
				window.localStorage.setItem('msgBoxList', JSON.stringify(msgBoxList)) //将数据保存到缓存
				$(this).parent().parent().remove()
			})

			//渲染html
			function innerHTMl(List) {
				List = List || []
				List.forEach(item => {
					let str =
						`<div class='msgBox'>
							<div class="headUrl">
								<img src='/static/admin/images/tx.jpg' width='50' height='50'/>
								<div>
									<span class="title">木林森里没有木</span>
									<span class="time">2018-01-01</span>
								</div>
								<a class="del">删除</a>
							</div>
							<div class='msgTxt'>
								${item.msg}
							</div>
						</div>`
					$(".msgCon").prepend(str);
				})
			}
		</script>
	</body>
</html>                                                 
